<!DOCTYPE html>
<html>
<head>
  <title>Lock Screen</title>
  <style>
    body {
      margin: 0;
      background: rgb(77, 76, 76);
      color: white;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    #video {
      display: none;
      width: 300px;
    }
    #status {
      margin-top: 10px;
    }
    #back, #ok, #passwordInput {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Locked</h1>

  <input type="password" id="passwordInput" placeholder="Enter password" />
  <video id="video" autoplay></video>
  <canvas id="canvas" hidden></canvas>

  <div id="status">Choose login method</div>

  <br/>

  <button id="password">Use Password</button>
  <button id="qrcode">Scan QR Code</button>
  <button id="ok">OK</button>
  <button id="back">Back</button>

  <script src="https://unpkg.com/jsqr"></script>
  <script>
    const passwordBtn = document.getElementById("password");
    const qrBtn = document.getElementById("qrcode");
    const okBtn = document.getElementById("ok");
    const backBtn = document.getElementById("back");
    const passwordInput = document.getElementById("passwordInput");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const status = document.getElementById("status");

    let stream;
    let scanning = false;

    passwordBtn.onclick = () => {
      passwordBtn.style.display = "none";
      qrBtn.style.display = "none";
      passwordInput.style.display = "block";
      okBtn.style.display = "inline-block";
      backBtn.style.display = "inline-block";
    };

    qrBtn.onclick = async () => {
      passwordBtn.style.display = "none";
      qrBtn.style.display = "none";
      video.style.display = "block";
      backBtn.style.display = "inline-block";
      status.textContent = "Starting camera...";
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
        scanning = true;
        status.textContent = "Scanning QR code...";
        scanLoop();
      } catch (err) {
        status.textContent = "Camera access denied.";
      }
    };

    okBtn.onclick = () => {
      if (passwordInput.value === "password") {
        status.textContent = "Unlocked!";
        document.body.innerHTML = "<h1 style='color: lime'>Welcome!</h1>";
      } else {
        status.textContent = "Incorrect password.";
      }
    };

    backBtn.onclick = () => {
      stopCamera();
      passwordInput.style.display = "none";
      video.style.display = "none";
      okBtn.style.display = "none";
      backBtn.style.display = "none";
      passwordBtn.style.display = "inline-block";
      qrBtn.style.display = "inline-block";
      status.textContent = "Choose login method";
    };

    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        scanning = false;
      }
    }

    function scanLoop() {
      if (!scanning) return;
      const ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(imageData.data, imageData.width, imageData.height);
      if (code) {
        scanning = false;
        stopCamera();
        status.textContent = `QR Code: ${code.data}`;
        document.body.innerHTML = "<h1 style='color: lime'>Unlocked by QR!</h1>";
        return;
      }
      requestAnimationFrame(scanLoop);
    }
  </script>

</body>
</html>
